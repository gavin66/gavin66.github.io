<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">



  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">



























  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/uploads/favicon.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/uploads/favicon.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/uploads/favicon.png?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.6.0',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="此文档描述了 RFC 7230 和 RFC 7231 HTTP 消息传递的接口，还有 RFC 3986 里对 HTTP 消息的 URIs 使用。 HTTP 消息是 Web 技术发展的基础。浏览器或 HTTP 客户端如 curl 生成发送 HTTP 请求消息到 Web 服务器，Web 服务器响应 HTTP 请求。服务端的代码接受 HTTP 请求消息后返回 HTTP 响应消息。">
<meta name="keywords" content="php,规范,psr">
<meta property="og:type" content="article">
<meta property="og:title" content="PSR-7 HTTP 消息接口规范">
<meta property="og:url" content="http://blog.imgavin.me/2016/04/11/php-psr7/index.html">
<meta property="og:site_name" content="Gavin&#39;s Blog">
<meta property="og:description" content="此文档描述了 RFC 7230 和 RFC 7231 HTTP 消息传递的接口，还有 RFC 3986 里对 HTTP 消息的 URIs 使用。 HTTP 消息是 Web 技术发展的基础。浏览器或 HTTP 客户端如 curl 生成发送 HTTP 请求消息到 Web 服务器，Web 服务器响应 HTTP 请求。服务端的代码接受 HTTP 请求消息后返回 HTTP 响应消息。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2017-02-09T09:02:18.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PSR-7 HTTP 消息接口规范">
<meta name="twitter:description" content="此文档描述了 RFC 7230 和 RFC 7231 HTTP 消息传递的接口，还有 RFC 3986 里对 HTTP 消息的 URIs 使用。 HTTP 消息是 Web 技术发展的基础。浏览器或 HTTP 客户端如 curl 生成发送 HTTP 请求消息到 Web 服务器，Web 服务器响应 HTTP 请求。服务端的代码接受 HTTP 请求消息后返回 HTTP 响应消息。">



  <link rel="alternate" href="/atom.xml" title="Gavin's Blog" type="application/atom+xml">




  <link rel="canonical" href="http://blog.imgavin.me/2016/04/11/php-psr7/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>PSR-7 HTTP 消息接口规范 | Gavin's Blog</title>
  












  <noscript>
  <style>
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion .logo-line-before i { left: initial; }
    .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Gavin's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">宁愿小众,不愿平庸</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-主页">

    
    
    

    

    <a href="/" rel="section">主页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-技术">

    
    
    

    

    <a href="/2014/08/24/page-tech/" rel="section">技术</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-生活">

    
    
    

    

    <a href="/2014/08/24/page-life/" rel="section">生活</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-归档">

    
    
    

    

    <a href="/archives/" rel="section">归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-关于">

    
    
    

    

    <a href="/about" rel="section">关于</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="st-search-show-outputs">
          
            搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input">
</form>

<script>
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 't-bzD9AonCuAKSmSy7ZA','2.0.0');
</script>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.imgavin.me/2016/04/11/php-psr7/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Gavin">
      <meta itemprop="description" content="宁愿小众,不愿平庸">
      <meta itemprop="image" content="/uploads/portrait.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Gavin's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">PSR-7 HTTP 消息接口规范

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-04-11 16:32:04" itemprop="dateCreated datePublished" datetime="2016-04-11T16:32:04+08:00">2016-04-11</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/04/11/php-psr7/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/04/11/php-psr7/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2016/04/11/php-psr7/" class="leancloud_visitors" data-flag-title="PSR-7 HTTP 消息接口规范">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>此文档描述了 <a href="http://tools.ietf.org/html/rfc7230" target="_blank" rel="noopener">RFC 7230</a> 和 <a href="http://tools.ietf.org/html/rfc7231" target="_blank" rel="noopener">RFC 7231</a> HTTP 消息传递的接口，还有 <a href="http://tools.ietf.org/html/rfc3986" target="_blank" rel="noopener">RFC 3986</a> 里对 HTTP 消息的 URIs 使用。</p>
<p>HTTP 消息是 Web 技术发展的基础。浏览器或 HTTP 客户端如 <code>curl</code> 生成发送 HTTP 请求消息到 Web 服务器，Web 服务器响应 HTTP 请求。服务端的代码接受 HTTP 请求消息后返回 HTTP 响应消息。</p>
<a id="more"></a>
<p>通常 HTTP 消息对于终端用户来说是不可见的，但是作为 Web 开发者，我们需要知道 HTTP 机制，如何发起、构建、取用还有操纵 HTTP 消息，知道这些原理，以助我们刚好的完成开发任务，无论这个任务是发起一个 HTTP 请求，或者处理传入的请求。</p>
<p>每一个 HTTP 请求都有专属的格式：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/path</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: example.com</span><br><span class="line"></span><br><span class="line">foo=bar&amp;baz=bat</span><br></pre></td></tr></table></figure>
<p>按照顺序，第一行的各个字段意义为： HTTP 请求方法、请求的目标地址（通常是一个绝对路径的 URI 或 者路径），HTTP 协议。</p>
<p>接下来是 HTTP 头信息，在这个例子中：目的主机。接下来是空行，然后是消息内容。</p>
<p>HTTP 返回消息有类似的结构：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Content-Type</span>: text/plain</span><br><span class="line"></span><br><span class="line">这是返回的消息内容</span><br></pre></td></tr></table></figure>
<p>按照顺序，第一行为状态行，包括 HTTP 协议版本，HTTP 状态码，描述文本。</p>
<p>和 HTTP 请求类似的，接下来是 HTTP 头信息，在这个例子中：内容类型。接下来是空行，然后是消息内容。</p>
<p>此文档探讨的是 HTTP 请求消息接口，和构建 HTTP 消息需要的元素数据定义。</p>
<p><em>参考资料</em></p>
<ul>
<li><a href="http://tools.ietf.org/html/rfc2119" target="_blank" rel="noopener">RFC 2119</a></li>
<li><a href="http://tools.ietf.org/html/rfc3986" target="_blank" rel="noopener">RFC 3986</a></li>
<li><a href="http://tools.ietf.org/html/rfc7230" target="_blank" rel="noopener">RFC 7230</a></li>
<li><a href="http://tools.ietf.org/html/rfc7231" target="_blank" rel="noopener">RFC 7231</a></li>
</ul>
<h2 id="关于「能愿动词」的使用"><a href="#关于「能愿动词」的使用" class="headerlink" title="关于「能愿动词」的使用"></a>关于「能愿动词」的使用</h2><p>为了避免歧义，文档大量使用了「能愿动词」，对应的解释如下：</p>
<ul>
<li><code>必须 (MUST)</code>：绝对，严格遵循，请照做，无条件遵守；</li>
<li><code>一定不可 (MUST NOT)</code>：禁令，严令禁止；</li>
<li><code>应该 (SHOULD)</code> ：强烈建议这样做，但是不强求；</li>
<li><code>不该 (SHOULD NOT)</code>：强烈不建议这样做，但是不强求；</li>
<li><code>可以 (MAY)</code> 和 <code>可选 (OPTIONAL)</code> ：选择性高一点，在这个文档内，此词语使用较少；</li>
</ul>
<blockquote>
<p>参见：<a href="http://www.ietf.org/rfc/rfc2119.txt" target="_blank" rel="noopener">RFC 2119</a></p>
</blockquote>
<h2 id="规范详情"><a href="#规范详情" class="headerlink" title="规范详情"></a>规范详情</h2><h3 id="消息"><a href="#消息" class="headerlink" title="消息"></a>消息</h3><p>一个 HTTP 消息，指定是一个从客户端发往服务器端的请求，或者是服务器端返回客户端的响应。对应的两 个消息接口：<code>Psr\Http\Message\RequestInterface</code> 和 <code>Psr\Http\Message\ResponseInterface</code>。</p>
<p>这个两个接口都继承于 <code>Psr\Http\Message\MessageInterface</code>。虽然你 <strong>可以</strong> 实现 <code>Psr\Http\Message\MessageInterface</code>接口，但是，最重要的，你 <strong>必须</strong> 实现 <code>Psr\Http\Message\RequestInterface</code> 和 <code>Psr\Http\Message\ResponseInterface</code> 接口。</p>
<p>从现在开始，为了行文的方便，我们提到这些接口的时候，都会把命名空间 <code>Psr\Http\Message</code> 去除掉。</p>
<h3 id="HTTP-头信息"><a href="#HTTP-头信息" class="headerlink" title="HTTP 头信息"></a>HTTP 头信息</h3><h4 id="大小写不敏感的字段名字"><a href="#大小写不敏感的字段名字" class="headerlink" title="大小写不敏感的字段名字"></a>大小写不敏感的字段名字</h4><p>HTTP 消息包含大小写不敏感头信息。使用 <code>MessageInterface</code> 接口来设置和获取头信息，大小写 不敏感的定义在于，如果你设置了一个 <code>Foo</code> 的头信息，<code>foo</code> 的值会被重写，你也可以通过 <code>foo</code> 来 拿到 <code>FoO</code> 头对应的值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$message = $message-&gt;withHeader(<span class="string">'foo'</span>, <span class="string">'bar'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $message-&gt;getHeaderLine(<span class="string">'foo'</span>);</span><br><span class="line"><span class="comment">// 输出: bar</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $message-&gt;getHeaderLine(<span class="string">'FOO'</span>);</span><br><span class="line"><span class="comment">// 输出: bar</span></span><br><span class="line"></span><br><span class="line">$message = $message-&gt;withHeader(<span class="string">'fOO'</span>, <span class="string">'baz'</span>);</span><br><span class="line"><span class="keyword">echo</span> $message-&gt;getHeaderLine(<span class="string">'foo'</span>);</span><br><span class="line"><span class="comment">// 输出: baz</span></span><br></pre></td></tr></table></figure>
<p>虽然头信息可以用大小写不敏感的方式取出，但是接口实现类 <strong>必须</strong> 保持自己的大小写规范，特别是用 <code>getHeaders()</code> 方法输出的内容。</p>
<p>因为一些非标准的 HTTP 应用程序，可能会依赖于大小写敏感的头信息，所有在此我们把主宰 HTTP 大小写的权利开放出来，以适用不同的场景。</p>
<h4 id="对应多条数组的头信息"><a href="#对应多条数组的头信息" class="headerlink" title="对应多条数组的头信息"></a>对应多条数组的头信息</h4><p>为了适用一个 HTTP 「键」可以对应多条数据的情况，我们使用字符串配合数组来实现，你可以从一个 <code>MessageInterface</code>取出数组或字符串，使用 <code>getHeaderLine($name)</code> 方法可以获取通过逗号分割的不区分大小写的字符串形式的所有值。也可以通过 <code>getHeader($name)</code> 获取数组形式头信息的所有值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$message = $message</span><br><span class="line">    -&gt;withHeader(<span class="string">'foo'</span>, <span class="string">'bar'</span>)</span><br><span class="line">    -&gt;withAddedHeader(<span class="string">'foo'</span>, <span class="string">'baz'</span>);</span><br><span class="line"></span><br><span class="line">$header = $message-&gt;getHeaderLine(<span class="string">'foo'</span>);</span><br><span class="line"><span class="comment">// $header 包含: 'bar, baz'</span></span><br><span class="line"></span><br><span class="line">$header = $message-&gt;getHeader(<span class="string">'foo'</span>);</span><br><span class="line"><span class="comment">// ['bar', 'baz']</span></span><br></pre></td></tr></table></figure>
<p>注意：并不是所有的头信息都可以适用逗号分割（例如 <code>Set-Cookie</code>），当处理这种头信息时候， <code>MessageInterace</code> 的继承类 <strong>应该</strong> 使用 <code>getHeader($name)</code> 方法来获取这种多值的情况。</p>
<h4 id="主机信息"><a href="#主机信息" class="headerlink" title="主机信息"></a>主机信息</h4><p>在请求中，<code>Host</code> 头信息通常和 URI 的 host 信息，还有建立起 TCP 连接使用的 Host 信息一致。 然而，HTTP 标准规范允许主机 <code>host</code> 信息与其他两个不一样。</p>
<p>在构建请求的时候，如果 <code>host</code> 头信息未提供的话，实现类库 <strong>必须</strong> 尝试着从 URI 中提取 <code>host</code> 信息。</p>
<p><code>RequestInterface::withUri()</code> 会默认的，从传参的 <code>UriInterface</code> 实例中提取 <code>host</code> ， 并替代请求中原有的 <code>host</code> 信息。</p>
<p>你可以提供传参第二个参数为 <code>true</code> 来保证返回的消息实例中，原有的 <code>host</code> 头信息不会被替代掉。</p>
<p>以下表格说明了当 <code>withUri()</code> 的第二个参数被设置为 <code>true</code> 的时，返回的消息实例中调用 <code>getHeaderLine(&#39;Host&#39;)</code> 方法会返回的内容：</p>
<table>
<thead>
<tr>
<th>请求 Host 头信息<a href="https://github.com/summerblue/psr.phphub.org/blob/master/psrs/%E3%80%8CPSR%20%E8%A7%84%E8%8C%83%E3%80%8DPSR-7%20HTTP%20%E6%B6%88%E6%81%AF%E6%8E%A5%E5%8F%A3%E8%A7%84%E8%8C%83.md#rhh" target="_blank" rel="noopener">1</a></th>
<th>请求 URI 中的 Host 信息<a href="https://github.com/summerblue/psr.phphub.org/blob/master/psrs/%E3%80%8CPSR%20%E8%A7%84%E8%8C%83%E3%80%8DPSR-7%20HTTP%20%E6%B6%88%E6%81%AF%E6%8E%A5%E5%8F%A3%E8%A7%84%E8%8C%83.md#rhc" target="_blank" rel="noopener">2</a></th>
<th>传参进去 URI 的 Host <a href="https://github.com/summerblue/psr.phphub.org/blob/master/psrs/%E3%80%8CPSR%20%E8%A7%84%E8%8C%83%E3%80%8DPSR-7%20HTTP%20%E6%B6%88%E6%81%AF%E6%8E%A5%E5%8F%A3%E8%A7%84%E8%8C%83.md#uhc" target="_blank" rel="noopener">3</a></th>
<th>结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>‘’</td>
<td>‘’</td>
<td>‘’</td>
<td>‘’</td>
</tr>
<tr>
<td>‘’</td>
<td>foo.com</td>
<td>‘’</td>
<td>foo.com</td>
</tr>
<tr>
<td>‘’</td>
<td>foo.com</td>
<td>bar.com</td>
<td>foo.com</td>
</tr>
<tr>
<td>foo.com</td>
<td>‘’</td>
<td>bar.com</td>
<td>foo.com</td>
</tr>
<tr>
<td>foo.com</td>
<td>bar.com</td>
<td>baz.com</td>
<td>foo.com</td>
</tr>
</tbody>
</table>
<ul>
<li>1 当前请求的 <code>Host</code> 头信息。</li>
<li>2 当前请求 <code>URI</code> 中的 <code>Host</code> 信息。</li>
<li>3 通过 <code>withUri()</code> 传参进入的 URI 中的 <code>host</code> 信息。</li>
</ul>
<h3 id="数据流"><a href="#数据流" class="headerlink" title="数据流"></a>数据流</h3><p>HTTP 消息包含开始的一行、头信息、还有消息的内容。HTTP 的消息内容有时候可以很小，有时候确是 非常巨大。尝试使用字符串的形式来展示消息内容，会消耗大量的内存，使用数据流的形式来读取消息 可以解决此问题。<code>StreamInterface</code> 接口用来隐藏具体的数据流读写实现。在一些情况下，消息 类型的读取方式为字符串是能容许的，可以使用 <code>php://memory</code> 或者 <code>php://temp</code>。</p>
<p><code>StreamInterface</code> 暴露出来几个接口，这些接口允许你读取、写入，还有高效的遍历内容。</p>
<p>数据流使用这个三个接口来阐明对他们的操作能力：<code>isReadable()</code>、<code>isWritable()</code> 和 <code>isSeekable()</code>。这些方法可以让数据流的操作者得知数据流能否能提供他们想要的功能。</p>
<p>每一个数据流的实例，都会有多种功能：可以只读、可以只写、可以读和写，可以随机读取，可以按顺序读取等。</p>
<p>最终，<code>StreamInterface</code> 定义了一个 <code>__toString()</code> 的方法，用来一次性以字符串的形式输出 所有消息内容。</p>
<p>与请求和响应的接口不同的是，<code>StreamInterface</code> 并不强调不可修改性。因为在 PHP 的实现内，基 本上没有办法保证不可修改性，因为指针的指向，内容的变更等状态，都是不可控的。作为读取者，可以 调用只读的方法来返回数据流，以最大程度上保证数据流的不可修改性。使用者要时刻明确的知道数据 流的可修改性，建议把数据流附加到消息实例中，来强迫不可修改的特性。</p>
<h3 id="请求目标和-URI"><a href="#请求目标和-URI" class="headerlink" title="请求目标和 URI"></a>请求目标和 URI</h3><blockquote>
<p>翻译到此先告一段落，此规范篇幅有点过长，需要消耗的时间挺长的，暂且翻译至此，他日再战。</p>
</blockquote>
<p>Per RFC 7230, request messages contain a “request-target” as the second segment of the request line. The request target can be one of the following forms:</p>
<ul>
<li><strong>origin-form</strong>, which consists of the path, and, if present, the query string; this is often referred to as a relative URL. Messages as transmitted over TCP typically are of origin-form; scheme and authority data are usually only present via CGI variables.</li>
<li><strong>absolute-form</strong>, which consists of the scheme, authority (“[user-info@]host[:port]”, where items in brackets are optional), path (if present), query string (if present), and fragment (if present). This is often referred to as an absolute URI, and is the only form to specify a URI as detailed in RFC 3986. This form is commonly used when making requests to HTTP proxies.</li>
<li><strong>authority-form</strong>, which consists of the authority only. This is typically used in CONNECT requests only, to establish a connection between an HTTP client and a proxy server.</li>
<li><strong>asterisk-form</strong>, which consists solely of the string <code>*</code>, and which is used with the OPTIONS method to determine the general capabilities of a web server.</li>
</ul>
<p>Aside from these request-targets, there is often an ‘effective URL’ which is separate from the request target. The effective URL is not transmitted within an HTTP message, but it is used to determine the protocol (http/https), port and hostname for making the request.</p>
<p>The effective URL is represented by <code>UriInterface</code>. <code>UriInterface</code> models HTTP and HTTPS URIs as specified in RFC 3986 (the primary use case). The interface provides methods for interacting with the various URI parts, which will obviate the need for repeated parsing of the URI. It also specifies a <code>__toString()</code> method for casting the modeled URI to its string representation.</p>
<p>When retrieving the request-target with <code>getRequestTarget()</code>, by default this method will use the URI object and extract all the necessary components to construct the <em>origin-form</em>. The <em>origin-form</em> is by far the most common request-target.</p>
<p>If it’s desired by an end-user to use one of the other three forms, or if the user wants to explicitly override the request-target, it is possible to do so with <code>withRequestTarget()</code>.</p>
<p>Calling this method does not affect the URI, as it is returned from <code>getUri()</code>.</p>
<p>For example, a user may want to make an asterisk-form request to a server:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$request = $request</span><br><span class="line">    -&gt;withMethod(<span class="string">'OPTIONS'</span>)</span><br><span class="line">    -&gt;withRequestTarget(<span class="string">'*'</span>)</span><br><span class="line">    -&gt;withUri(<span class="keyword">new</span> Uri(<span class="string">'https://example.org/'</span>));</span><br></pre></td></tr></table></figure>
<p>This example may ultimately result in an HTTP request that looks like this:</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">OPTIONS</span> <span class="string">*</span> HTTP/1.1</span><br></pre></td></tr></table></figure>
<p>But the HTTP client will be able to use the effective URL (from <code>getUri()</code>), to determine the protocol, hostname and TCP port.</p>
<p>An HTTP client MUST ignore the values of <code>Uri::getPath()</code> and <code>Uri::getQuery()</code>, and instead use the value returned by <code>getRequestTarget()</code>, which defaults to concatenating these two values.</p>
<p>Clients that choose to not implement 1 or more of the 4 request-target forms, MUST still use <code>getRequestTarget()</code>. These clients MUST reject request-targets they do not support, and MUST NOT fall back on the values from <code>getUri()</code>.</p>
<p><code>RequestInterface</code> provides methods for retrieving the request-target or creating a new instance with the provided request-target. By default, if no request-target is specifically composed in the instance, <code>getRequestTarget()</code> will return the origin-form of the composed URI (or “/“ if no URI is composed). <code>withRequestTarget($requestTarget)</code>creates a new instance with the specified request target, and thus allows developers to create request messages that represent the other three request-target forms (absolute-form, authority-form, and asterisk-form). When used, the composed URI instance can still be of use, particularly in clients, where it may be used to create the connection to the server.</p>
<h3 id="Server-side-Requests"><a href="#Server-side-Requests" class="headerlink" title="Server-side Requests"></a>Server-side Requests</h3><p><code>RequestInterface</code> provides the general representation of an HTTP request message. However, server-side requests need additional treatment, due to the nature of the server-side environment. Server-side processing needs to take into account Common Gateway Interface (CGI), and, more specifically, PHP’s abstraction and extension of CGI via its Server APIs (SAPI). PHP has provided simplification around input marshaling via superglobals such as:</p>
<ul>
<li><code>$_COOKIE</code>, which deserializes and provides simplified access for HTTP cookies.</li>
<li><code>$_GET</code>, which deserializes and provides simplified access for query string arguments.</li>
<li><code>$_POST</code>, which deserializes and provides simplified access for urlencoded parameters submitted via HTTP POST; generically, it can be considered the results of parsing the message body.</li>
<li><code>$_FILES</code>, which provides serialized metadata around file uploads.</li>
<li><code>$_SERVER</code>, which provides access to CGI/SAPI environment variables, which commonly include the request method, the request scheme, the request URI, and headers.</li>
</ul>
<p><code>ServerRequestInterface</code> extends <code>RequestInterface</code> to provide an abstraction around these various superglobals. This practice helps reduce coupling to the superglobals by consumers, and encourages and promotes the ability to test request consumers.</p>
<p>The server request provides one additional property, “attributes”, to allow consumers the ability to introspect, decompose, and match the request against application-specific rules (such as path matching, scheme matching, host matching, etc.). As such, the server request can also provide messaging between multiple request consumers.</p>
<h3 id="Uploaded-files"><a href="#Uploaded-files" class="headerlink" title="Uploaded files"></a>Uploaded files</h3><p><code>ServerRequestInterface</code> specifies a method for retrieving a tree of upload files in a normalized structure, with each leaf an instance of <code>UploadedFileInterface</code>.</p>
<p>The <code>$_FILES</code> superglobal has some well-known problems when dealing with arrays of file inputs. As an example, if you have a form that submits an array of files — e.g., the input name “files”, submitting <code>files[0]</code> and <code>files[1]</code> — PHP will represent this as:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'files'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">'name'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">            <span class="number">0</span> =&gt; <span class="string">'file0.txt'</span>,</span><br><span class="line">            <span class="number">1</span> =&gt; <span class="string">'file1.html'</span>,</span><br><span class="line">        ),</span><br><span class="line">        <span class="string">'type'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">            <span class="number">0</span> =&gt; <span class="string">'text/plain'</span>,</span><br><span class="line">            <span class="number">1</span> =&gt; <span class="string">'text/html'</span>,</span><br><span class="line">        ),</span><br><span class="line">        <span class="comment">/* etc. */</span></span><br><span class="line">    ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>instead of the expected:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'files'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">        <span class="number">0</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'name'</span> =&gt; <span class="string">'file0.txt'</span>,</span><br><span class="line">            <span class="string">'type'</span> =&gt; <span class="string">'text/plain'</span>,</span><br><span class="line">            <span class="comment">/* etc. */</span></span><br><span class="line">        ),</span><br><span class="line">        <span class="number">1</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'name'</span> =&gt; <span class="string">'file1.html'</span>,</span><br><span class="line">            <span class="string">'type'</span> =&gt; <span class="string">'text/html'</span>,</span><br><span class="line">            <span class="comment">/* etc. */</span></span><br><span class="line">        ),</span><br><span class="line">    ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>The result is that consumers need to know this language implementation detail, and write code for gathering the data for a given upload.</p>
<p>Additionally, scenarios exist where <code>$_FILES</code> is not populated when file uploads occur:</p>
<ul>
<li>When the HTTP method is not <code>POST</code>.</li>
<li>When unit testing.</li>
<li>When operating under a non-SAPI environment, such as <a href="http://reactphp.org/" target="_blank" rel="noopener">ReactPHP</a>.</li>
</ul>
<p>In such cases, the data will need to be seeded differently. As examples:</p>
<ul>
<li>A process might parse the message body to discover the file uploads. In such cases, the implementation may choose <em>not</em> to write the file uploads to the file system, but instead wrap them in a stream in order to reduce memory, I/O, and storage overhead.</li>
<li>In unit testing scenarios, developers need to be able to stub and/or mock the file upload metadata in order to validate and verify different scenarios.</li>
</ul>
<p><code>getUploadedFiles()</code> provides the normalized structure for consumers. Implementations are expected to:</p>
<ul>
<li>Aggregate all information for a given file upload, and use it to populate a<code>Psr\Http\Message\UploadedFileInterface</code> instance.</li>
<li>Re-create the submitted tree structure, with each leaf being the appropriate<code>Psr\Http\Message\UploadedFileInterface</code> instance for the given location in the tree.</li>
</ul>
<p>The tree structure referenced should mimic the naming structure in which files were submitted.</p>
<p>In the simplest example, this might be a single named form element submitted as:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">"file"</span> name=<span class="string">"avatar"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>In this case, the structure in <code>$_FILES</code> would look like:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'avatar'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">'tmp_name'</span> =&gt; <span class="string">'phpUxcOty'</span>,</span><br><span class="line">        <span class="string">'name'</span> =&gt; <span class="string">'my-avatar.png'</span>,</span><br><span class="line">        <span class="string">'size'</span> =&gt; <span class="number">90996</span>,</span><br><span class="line">        <span class="string">'type'</span> =&gt; <span class="string">'image/png'</span>,</span><br><span class="line">        <span class="string">'error'</span> =&gt; <span class="number">0</span>,</span><br><span class="line">    ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>The normalized form returned by <code>getUploadedFiles()</code> would be:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'avatar'</span> =&gt; <span class="comment">/* UploadedFileInterface instance */</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>In the case of an input using array notation for the name:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">"file"</span> name=<span class="string">"my-form[details][avatar]"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p><code>$_FILES</code> ends up looking like this:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'my-form'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">'details'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'avatar'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">'tmp_name'</span> =&gt; <span class="string">'phpUxcOty'</span>,</span><br><span class="line">                <span class="string">'name'</span> =&gt; <span class="string">'my-avatar.png'</span>,</span><br><span class="line">                <span class="string">'size'</span> =&gt; <span class="number">90996</span>,</span><br><span class="line">                <span class="string">'type'</span> =&gt; <span class="string">'image/png'</span>,</span><br><span class="line">                <span class="string">'error'</span> =&gt; <span class="number">0</span>,</span><br><span class="line">            ),</span><br><span class="line">        ),</span><br><span class="line">    ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>And the corresponding tree returned by <code>getUploadedFiles()</code> should be:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'my-form'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">'details'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'avatar'</span> =&gt; <span class="comment">/* UploadedFileInterface instance */</span></span><br><span class="line">        ),</span><br><span class="line">    ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>In some cases, you may specify an array of files:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Upload an avatar: &lt;input type=<span class="string">"file"</span> name=<span class="string">"my-form[details][avatars][]"</span> /&gt;</span><br><span class="line">Upload an avatar: &lt;input type=<span class="string">"file"</span> name=<span class="string">"my-form[details][avatars][]"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>(As an example, JavaScript controls might spawn additional file upload inputs to allow uploading multiple files at once.)</p>
<p>In such a case, the specification implementation must aggregate all information related to the file at the given index. The reason is because <code>$_FILES</code> deviates from its normal structure in such cases:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'my-form'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">'details'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'avatars'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">'tmp_name'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">                    <span class="number">0</span> =&gt; <span class="string">'...'</span>,</span><br><span class="line">                    <span class="number">1</span> =&gt; <span class="string">'...'</span>,</span><br><span class="line">                    <span class="number">2</span> =&gt; <span class="string">'...'</span>,</span><br><span class="line">                ),</span><br><span class="line">                <span class="string">'name'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">                    <span class="number">0</span> =&gt; <span class="string">'...'</span>,</span><br><span class="line">                    <span class="number">1</span> =&gt; <span class="string">'...'</span>,</span><br><span class="line">                    <span class="number">2</span> =&gt; <span class="string">'...'</span>,</span><br><span class="line">                ),</span><br><span class="line">                <span class="string">'size'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">                    <span class="number">0</span> =&gt; <span class="string">'...'</span>,</span><br><span class="line">                    <span class="number">1</span> =&gt; <span class="string">'...'</span>,</span><br><span class="line">                    <span class="number">2</span> =&gt; <span class="string">'...'</span>,</span><br><span class="line">                ),</span><br><span class="line">                <span class="string">'type'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">                    <span class="number">0</span> =&gt; <span class="string">'...'</span>,</span><br><span class="line">                    <span class="number">1</span> =&gt; <span class="string">'...'</span>,</span><br><span class="line">                    <span class="number">2</span> =&gt; <span class="string">'...'</span>,</span><br><span class="line">                ),</span><br><span class="line">                <span class="string">'error'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">                    <span class="number">0</span> =&gt; <span class="string">'...'</span>,</span><br><span class="line">                    <span class="number">1</span> =&gt; <span class="string">'...'</span>,</span><br><span class="line">                    <span class="number">2</span> =&gt; <span class="string">'...'</span>,</span><br><span class="line">                ),</span><br><span class="line">            ),</span><br><span class="line">        ),</span><br><span class="line">    ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>The above <code>$_FILES</code> array would correspond to the following structure as returned by <code>getUploadedFiles()</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'my-form'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">'details'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'avatars'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">                <span class="number">0</span> =&gt; <span class="comment">/* UploadedFileInterface instance */</span>,</span><br><span class="line">                <span class="number">1</span> =&gt; <span class="comment">/* UploadedFileInterface instance */</span>,</span><br><span class="line">                <span class="number">2</span> =&gt; <span class="comment">/* UploadedFileInterface instance */</span>,</span><br><span class="line">            ),</span><br><span class="line">        ),</span><br><span class="line">    ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>Consumers would access index <code>1</code> of the nested array using:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$request-&gt;getUploadedFiles()[<span class="string">'my-form'</span>][<span class="string">'details'</span>][<span class="string">'avatars'</span>][<span class="number">1</span>];</span><br></pre></td></tr></table></figure>
<p>Because the uploaded files data is derivative (derived from <code>$_FILES</code> or the request body), a mutator method, <code>withUploadedFiles()</code>, is also present in the interface, allowing delegation of the normalization to another process.</p>
<p>In the case of the original examples, consumption resembles the following:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$file0 = $request-&gt;getUploadedFiles()[<span class="string">'files'</span>][<span class="number">0</span>];</span><br><span class="line">$file1 = $request-&gt;getUploadedFiles()[<span class="string">'files'</span>][<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">printf(</span><br><span class="line">    <span class="string">"Received the files %s and %s"</span>,</span><br><span class="line">    $file0-&gt;getClientFilename(),</span><br><span class="line">    $file1-&gt;getClientFilename()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// "Received the files file0.txt and file1.html"</span></span><br></pre></td></tr></table></figure>
<p>This proposal also recognizes that implementations may operate in non-SAPI environments. As such, <code>UploadedFileInterface</code> provides methods for ensuring operations will work regardless of environment. In particular:</p>
<ul>
<li><code>moveTo($targetPath)</code> is provided as a safe and recommended alternative to calling <code>move_uploaded_file()</code>directly on the temporary upload file. Implementations will detect the correct operation to use based on environment.</li>
<li><code>getStream()</code> will return a <code>StreamInterface</code> instance. In non-SAPI environments, one proposed possibility is to parse individual upload files into <code>php://temp</code> streams instead of directly to files; in such cases, no upload file is present. <code>getStream()</code> is therefore guaranteed to work regardless of environment.</li>
</ul>
<p>As examples:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Move a file to an upload directory</span></span><br><span class="line">$filename = sprintf(</span><br><span class="line">    <span class="string">'%s.%s'</span>,</span><br><span class="line">    create_uuid(),</span><br><span class="line">    pathinfo($file0-&gt;getClientFilename(), PATHINFO_EXTENSION)</span><br><span class="line">);</span><br><span class="line">$file0-&gt;moveTo(DATA_DIR . <span class="string">'/'</span> . $filename);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Stream a file to Amazon S3.</span></span><br><span class="line"><span class="comment">// Assume $s3wrapper is a PHP stream that will write to S3, and that</span></span><br><span class="line"><span class="comment">// Psr7StreamWrapper is a class that will decorate a StreamInterface as a PHP</span></span><br><span class="line"><span class="comment">// StreamWrapper.</span></span><br><span class="line">$stream = <span class="keyword">new</span> Psr7StreamWrapper($file1-&gt;getStream());</span><br><span class="line">stream_copy_to_stream($stream, $s3wrapper);</span><br></pre></td></tr></table></figure>
<h2 id="Package"><a href="#Package" class="headerlink" title="Package"></a>Package</h2><p>上面讨论的接口和类库已经整合成为扩展包： <a href="https://packagist.org/packages/psr/http-message" target="_blank" rel="noopener">psr/http-message</a>。</p>
<h2 id="Interfaces"><a href="#Interfaces" class="headerlink" title="Interfaces"></a>Interfaces</h2><h3 id="Psr-Http-Message-MessageInterface"><a href="#Psr-Http-Message-MessageInterface" class="headerlink" title="Psr\Http\Message\MessageInterface"></a><code>Psr\Http\Message\MessageInterface</code></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Psr</span>\<span class="title">Http</span>\<span class="title">Message</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * HTTP 消息值得是客户端发起的「请求」和服务器端返回的「响应」，此接口</span></span><br><span class="line"><span class="comment"> * 定义了他们通用的方法。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * HTTP 消息是被视为无法修改的，所有能修改状态的方法，都 **必须** 有一套</span></span><br><span class="line"><span class="comment"> * 机制，在内部保持好原有的内容，然后把修改状态后的信息返回。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> http://www.ietf.org/rfc/rfc7230.txt</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> http://www.ietf.org/rfc/rfc7231.txt</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">MessageInterface</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取字符串形式的 HTTP 协议版本信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 字符串必须包含 HTTP 版本数字，如："1.1", "1.0"。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string HTTP 协议版本</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getProtocolVersion</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回指定 HTTP 版本号的消息实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 传参的版本号必须 **只** 包含 HTTP 版本数字，如："1.1", "1.0"。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息对象，然后返回</span></span><br><span class="line"><span class="comment">     * 一个新的带有传参进去的 HTTP 版本的实例</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $version HTTP 版本信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> self</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withProtocolVersion</span><span class="params">($version)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有的头信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 返回的二维数组中，第一维数组的「键」代表单条头信息的名字，「值」是</span></span><br><span class="line"><span class="comment">     * 以数据形式返回的，见以下实例：</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *     // 把「值」的数据当成字串打印出来</span></span><br><span class="line"><span class="comment">     *     foreach ($message-&gt;getHeaders() as $name =&gt; $values) &#123;</span></span><br><span class="line"><span class="comment">     *         echo $name . ': ' . implode(', ', $values);</span></span><br><span class="line"><span class="comment">     *     &#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *     // 迭代的循环二维数组</span></span><br><span class="line"><span class="comment">     *     foreach ($message-&gt;getHeaders() as $name =&gt; $values) &#123;</span></span><br><span class="line"><span class="comment">     *         foreach ($values as $value) &#123;</span></span><br><span class="line"><span class="comment">     *             header(sprintf('%s: %s', $name, $value), false);</span></span><br><span class="line"><span class="comment">     *         &#125;</span></span><br><span class="line"><span class="comment">     *     &#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 虽然头信息是没有大小写之分，但是使用 `getHeaders()` 会返回保留了原本</span></span><br><span class="line"><span class="comment">     * 大小写形式的内容。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string[][] 返回一个两维数组，第一维数组的「键」 **必须** 为单条头信息的</span></span><br><span class="line"><span class="comment">     *     名称，对应的是由字串组成的数组，请注意，对应的「值」 **必须** 是数组形式的。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getHeaders</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查是否头信息中包含有此名称的值，不区分大小写</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $name 不区分大小写的头信息名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> bool 找到返回 true，未找到返回 false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hasHeader</span><span class="params">($name)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据给定的名称，获取一条头信息，不区分大小写，以数组形式返回</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 此方法以数组形式返回对应名称的头信息。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 如果没有对应的头信息，**必须** 返回一个空数组。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $name 不区分大小写的头部字段名称。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string[] 返回头信息中，对应名称的，由字符串组成的数组值，如果没有对应</span></span><br><span class="line"><span class="comment">     *  的内容，**必须** 返回空数组。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getHeader</span><span class="params">($name)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据给定的名称，获取一条头信息，不区分大小写，以逗号分隔的形式返回</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * 此方法返回所有对应的头信息，并将其使用逗号分隔的方法拼接起来。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 注意：不是所有的头信息都可使用逗号分隔的方法来拼接，对于那些头信息，请使用</span></span><br><span class="line"><span class="comment">     * `getHeader()` 方法来获取。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * 如果没有对应的头信息，此方法 **必须** 返回一个空字符串。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $name 不区分大小写的头部字段名称。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string 返回头信息中，对应名称的，由逗号分隔组成的字串，如果没有对应</span></span><br><span class="line"><span class="comment">     *  的内容，**必须** 返回空字符串。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getHeaderLine</span><span class="params">($name)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回指定头信息「键/值」对的消息实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 虽然头信息是不区分大小写的，但是此方法必须保留其传参时的大小写状态，并能够在</span></span><br><span class="line"><span class="comment">     * 调用 `getHeaders()` 的时候被取出。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息对象，然后返回</span></span><br><span class="line"><span class="comment">     * 一个新的带有传参进去头信息的实例</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $name Case-insensitive header field name.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string|string[] $value Header value(s).</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> self</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \InvalidArgumentException for invalid header names or values.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withHeader</span><span class="params">($name, $value)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回一个头信息增量的 HTTP 消息实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 原有的头信息会被保留，新的值会作为增量加上，如果头信息不存在的话，会被加上。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息对象，然后返回</span></span><br><span class="line"><span class="comment">     * 一个新的修改过的 HTTP 消息实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $name 不区分大小写的头部字段名称。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string|string[] $value 头信息对应的值。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> self</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \InvalidArgumentException 头信息字段名称非法时会被抛出。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \InvalidArgumentException 头信息的值非法的时候，会被抛出。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withAddedHeader</span><span class="params">($name, $value)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回被移除掉指定头信息的 HTTP 消息实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 头信息字段在解析的时候，**必须** 保证是不区分大小写的。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息对象，然后返回</span></span><br><span class="line"><span class="comment">     * 一个新的修改过的 HTTP 消息实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $name 不区分大小写的头部字段名称。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> self</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withoutHeader</span><span class="params">($name)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取 HTTP 消息的内容。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> StreamInterface 以数据流的形式返回。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBody</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回拼接了内容的 HTTP 消息实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 内容 **必须** 是 StreamInterface 接口的实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息对象，然后返回</span></span><br><span class="line"><span class="comment">     * 一个新的修改过的 HTTP 消息实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> StreamInterface $body 数据流形式的内容。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> self</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \InvalidArgumentException 当消息内容不正确的时候。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withBody</span><span class="params">(StreamInterface $body)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Psr-Http-Message-RequestInterface"><a href="#Psr-Http-Message-RequestInterface" class="headerlink" title="Psr\Http\Message\RequestInterface"></a><code>Psr\Http\Message\RequestInterface</code></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Psr</span>\<span class="title">Http</span>\<span class="title">Message</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 代表客户端请求的 HTTP 消息对象。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 根据规范，每一个 HTTP 请求都包含以下信息：</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * - HTTP 协议版本号 (Protocol version)</span></span><br><span class="line"><span class="comment"> * - HTTP 请求方法 (HTTP method)</span></span><br><span class="line"><span class="comment"> * - URI</span></span><br><span class="line"><span class="comment"> * - 头信息 (Headers)</span></span><br><span class="line"><span class="comment"> * - 消息内容 (Message body)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 在构造 HTTP 请求对象的时候，实现类库 **必须** 从给出的 URI 中去提取 HOST 信息。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * HTTP 请求是被视为无法修改的，所有能修改状态的方法，都 **必须** 有一套机制，在内部保</span></span><br><span class="line"><span class="comment"> * 持好原有的内容，然后把修改状态后的，新的 HTTP 请求实例返回。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">RequestInterface</span> <span class="keyword">extends</span> <span class="title">MessageInterface</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取消息请求的目标。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 在大部分情况下，此方法会返回完整的 URI，除非 `withRequestTarget()` 被设置过。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 如果没有提供 URI，并且没有提供任何的请求目标，此方法 **必须** 返回 "/"。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getRequestTarget</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回一个指定目标的请求实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 请求实例，然后返回</span></span><br><span class="line"><span class="comment">     * 一个新的修改过的 HTTP 请求实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> 关于请求目标的各种允许的格式，请见 http://tools.ietf.org/html/rfc7230#section-2.7 </span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mixed $requestTarget</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> self</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withRequestTarget</span><span class="params">($requestTarget)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当前请求使用的 HTTP 方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string HTTP 方法字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getMethod</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回更改了请求方法的消息实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 虽然，在大部分情况下，HTTP 请求方法都是使用大写字母来标示的，但是，实现类库 **一定不可**</span></span><br><span class="line"><span class="comment">     * 修改用户传参的大小格式。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 请求实例，然后返回</span></span><br><span class="line"><span class="comment">     * 一个新的修改过的 HTTP 请求实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $method 大小写敏感的方法名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> self</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \InvalidArgumentException 当非法的 HTTP 方法名传入时会抛出异常。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withMethod</span><span class="params">($method)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取 URI 实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 此方法必须返回 `UriInterface` 的 URI 实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> http://tools.ietf.org/html/rfc3986#section-4.3</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> UriInterface 返回与当前请求相关 `UriInterface` 类型的 URI 实例。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getUri</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回修改了 URI 的消息实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 当传入的 `URI` 包含有 `HOST` 信息时，**必须** 更新 `HOST` 头信息，如果 `URI` </span></span><br><span class="line"><span class="comment">     * 实例没有附带 `HOST` 信息，任何之前存在的 `HOST` 信息 **必须** 作为候补，应用</span></span><br><span class="line"><span class="comment">     * 更改到返回的消息实例里。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * 你可以通过传入第二个参数来，来干预方法的处理，当 `$preserveHost` 设置为 `true` </span></span><br><span class="line"><span class="comment">     * 的时候，会保留原来的 `HOST` 信息。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 请求实例，然后返回</span></span><br><span class="line"><span class="comment">     * 一个新的修改过的 HTTP 请求实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> http://tools.ietf.org/html/rfc3986#section-4.3</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> UriInterface $uri `UriInterface` 类型的 URI 实例</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bool $preserveHost 是否保留原有的 HOST 头信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> self</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withUri</span><span class="params">(UriInterface $uri, $preserveHost = false)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Psr-Http-Message-ServerRequestInterface"><a href="#Psr-Http-Message-ServerRequestInterface" class="headerlink" title="Psr\Http\Message\ServerRequestInterface"></a><code>Psr\Http\Message\ServerRequestInterface</code></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Psr</span>\<span class="title">Http</span>\<span class="title">Message</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Representation of an incoming, server-side HTTP request.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Per the HTTP specification, this interface includes properties for</span></span><br><span class="line"><span class="comment"> * each of the following:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * - Protocol version</span></span><br><span class="line"><span class="comment"> * - HTTP method</span></span><br><span class="line"><span class="comment"> * - URI</span></span><br><span class="line"><span class="comment"> * - Headers</span></span><br><span class="line"><span class="comment"> * - Message body</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Additionally, it encapsulates all data as it has arrived to the</span></span><br><span class="line"><span class="comment"> * application from the CGI and/or PHP environment, including:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * - The values represented in $_SERVER.</span></span><br><span class="line"><span class="comment"> * - Any cookies provided (generally via $_COOKIE)</span></span><br><span class="line"><span class="comment"> * - Query string arguments (generally via $_GET, or as parsed via parse_str())</span></span><br><span class="line"><span class="comment"> * - Upload files, if any (as represented by $_FILES)</span></span><br><span class="line"><span class="comment"> * - Deserialized body parameters (generally from $_POST)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * $_SERVER values MUST be treated as immutable, as they represent application</span></span><br><span class="line"><span class="comment"> * state at the time of request; as such, no methods are provided to allow</span></span><br><span class="line"><span class="comment"> * modification of those values. The other values provide such methods, as they</span></span><br><span class="line"><span class="comment"> * can be restored from $_SERVER or the request body, and may need treatment</span></span><br><span class="line"><span class="comment"> * during the application (e.g., body parameters may be deserialized based on</span></span><br><span class="line"><span class="comment"> * content type).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Additionally, this interface recognizes the utility of introspecting a</span></span><br><span class="line"><span class="comment"> * request to derive and match additional parameters (e.g., via URI path</span></span><br><span class="line"><span class="comment"> * matching, decrypting cookie values, deserializing non-form-encoded body</span></span><br><span class="line"><span class="comment"> * content, matching authorization headers to users, etc). These parameters</span></span><br><span class="line"><span class="comment"> * are stored in an "attributes" property.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * HTTP 请求是被视为无法修改的，所有能修改状态的方法，都 **必须** 有一套机制，在内部保</span></span><br><span class="line"><span class="comment"> * 持好原有的内容，然后把修改状态后的，新的 HTTP 请求实例返回。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ServerRequestInterface</span> <span class="keyword">extends</span> <span class="title">RequestInterface</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Retrieve server parameters.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Retrieves data related to the incoming request environment,</span></span><br><span class="line"><span class="comment">     * typically derived from PHP's $_SERVER superglobal. The data IS NOT</span></span><br><span class="line"><span class="comment">     * REQUIRED to originate from $_SERVER.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getServerParams</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Retrieve cookies.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Retrieves cookies sent by the client to the server.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * The data MUST be compatible with the structure of the $_COOKIE</span></span><br><span class="line"><span class="comment">     * superglobal.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getCookieParams</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return an instance with the specified cookies.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * The data IS NOT REQUIRED to come from the $_COOKIE superglobal, but MUST</span></span><br><span class="line"><span class="comment">     * be compatible with the structure of $_COOKIE. Typically, this data will</span></span><br><span class="line"><span class="comment">     * be injected at instantiation.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This method MUST NOT update the related Cookie header of the request</span></span><br><span class="line"><span class="comment">     * instance, nor related values in the server params.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息实例，然后返回</span></span><br><span class="line"><span class="comment">     * 一个新的修改过的 HTTP 消息实例。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array $cookies Array of key/value pairs representing cookies.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> self</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withCookieParams</span><span class="params">(array $cookies)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Retrieve query string arguments.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Retrieves the deserialized query string arguments, if any.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">Note:</span> the query params might not be in sync with the URI or server</span></span><br><span class="line"><span class="comment">     * params. If you need to ensure you are only getting the original</span></span><br><span class="line"><span class="comment">     * values, you may need to parse the query string from `getUri()-&gt;getQuery()`</span></span><br><span class="line"><span class="comment">     * or from the `QUERY_STRING` server param.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getQueryParams</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return an instance with the specified query string arguments.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * These values SHOULD remain immutable over the course of the incoming</span></span><br><span class="line"><span class="comment">     * request. They MAY be injected during instantiation, such as from PHP's</span></span><br><span class="line"><span class="comment">     * $_GET superglobal, or MAY be derived from some other value such as the</span></span><br><span class="line"><span class="comment">     * URI. In cases where the arguments are parsed from the URI, the data</span></span><br><span class="line"><span class="comment">     * MUST be compatible with what PHP's parse_str() would return for</span></span><br><span class="line"><span class="comment">     * purposes of how duplicate query parameters are handled, and how nested</span></span><br><span class="line"><span class="comment">     * sets are handled.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Setting query string arguments MUST NOT change the URI stored by the</span></span><br><span class="line"><span class="comment">     * request, nor the values in the server params.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息实例，然后返回</span></span><br><span class="line"><span class="comment">     * 一个新的修改过的 HTTP 消息实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array $query Array of query string arguments, typically from</span></span><br><span class="line"><span class="comment">     *     $_GET.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> self</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withQueryParams</span><span class="params">(array $query)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Retrieve normalized file upload data.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This method returns upload metadata in a normalized tree, with each leaf</span></span><br><span class="line"><span class="comment">     * an instance of Psr\Http\Message\UploadedFileInterface.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * These values MAY be prepared from $_FILES or the message body during</span></span><br><span class="line"><span class="comment">     * instantiation, or MAY be injected via withUploadedFiles().</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array An array tree of UploadedFileInterface instances; an empty</span></span><br><span class="line"><span class="comment">     *     array MUST be returned if no data is present.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getUploadedFiles</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new instance with the specified uploaded files.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息实例，然后返回</span></span><br><span class="line"><span class="comment">     * 一个新的修改过的 HTTP 消息实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array An array tree of UploadedFileInterface instances.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> self</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \InvalidArgumentException if an invalid structure is provided.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withUploadedFiles</span><span class="params">(array $uploadedFiles)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Retrieve any parameters provided in the request body.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * If the request Content-Type is either application/x-www-form-urlencoded</span></span><br><span class="line"><span class="comment">     * or multipart/form-data, and the request method is POST, this method MUST</span></span><br><span class="line"><span class="comment">     * return the contents of $_POST.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Otherwise, this method may return any results of deserializing</span></span><br><span class="line"><span class="comment">     * the request body content; as parsing returns structured content, the</span></span><br><span class="line"><span class="comment">     * potential types MUST be arrays or objects only. A null value indicates</span></span><br><span class="line"><span class="comment">     * the absence of body content.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> null|array|object The deserialized body parameters, if any.</span></span><br><span class="line"><span class="comment">     *     These will typically be an array or object.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getParsedBody</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return an instance with the specified body parameters.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * These MAY be injected during instantiation.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * If the request Content-Type is either application/x-www-form-urlencoded</span></span><br><span class="line"><span class="comment">     * or multipart/form-data, and the request method is POST, use this method</span></span><br><span class="line"><span class="comment">     * ONLY to inject the contents of $_POST.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * The data IS NOT REQUIRED to come from $_POST, but MUST be the results of</span></span><br><span class="line"><span class="comment">     * deserializing the request body content. Deserialization/parsing returns</span></span><br><span class="line"><span class="comment">     * structured data, and, as such, this method ONLY accepts arrays or objects,</span></span><br><span class="line"><span class="comment">     * or a null value if nothing was available to parse.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * As an example, if content negotiation determines that the request data</span></span><br><span class="line"><span class="comment">     * is a JSON payload, this method could be used to create a request</span></span><br><span class="line"><span class="comment">     * instance with the deserialized parameters.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息实例，然后返回</span></span><br><span class="line"><span class="comment">     * 一个新的修改过的 HTTP 消息实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> null|array|object $data The deserialized body data. This will</span></span><br><span class="line"><span class="comment">     *     typically be in an array or object.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> self</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \InvalidArgumentException if an unsupported argument type is</span></span><br><span class="line"><span class="comment">     *     provided.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withParsedBody</span><span class="params">($data)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Retrieve attributes derived from the request.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * The request "attributes" may be used to allow injection of any</span></span><br><span class="line"><span class="comment">     * parameters derived from the request: e.g., the results of path</span></span><br><span class="line"><span class="comment">     * match operations; the results of decrypting cookies; the results of</span></span><br><span class="line"><span class="comment">     * deserializing non-form-encoded message bodies; etc. Attributes</span></span><br><span class="line"><span class="comment">     * will be application and request specific, and CAN be mutable.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed[] Attributes derived from the request.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAttributes</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Retrieve a single derived request attribute.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Retrieves a single derived request attribute as described in</span></span><br><span class="line"><span class="comment">     * getAttributes(). If the attribute has not been previously set, returns</span></span><br><span class="line"><span class="comment">     * the default value as provided.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This method obviates the need for a hasAttribute() method, as it allows</span></span><br><span class="line"><span class="comment">     * specifying a default value to return if the attribute is not found.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> getAttributes()</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $name The attribute name.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mixed $default Default value to return if the attribute does not exist.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAttribute</span><span class="params">($name, $default = null)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return an instance with the specified derived request attribute.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This method allows setting a single derived request attribute as</span></span><br><span class="line"><span class="comment">     * described in getAttributes().</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息实例，然后返回</span></span><br><span class="line"><span class="comment">     * 一个新的修改过的 HTTP 消息实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> getAttributes()</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $name The attribute name.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mixed $value The value of the attribute.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> self</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withAttribute</span><span class="params">($name, $value)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return an instance that removes the specified derived request attribute.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This method allows removing a single derived request attribute as</span></span><br><span class="line"><span class="comment">     * described in getAttributes().</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息实例，然后返回</span></span><br><span class="line"><span class="comment">     * 一个新的修改过的 HTTP 消息实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> getAttributes()</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $name The attribute name.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> self</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withoutAttribute</span><span class="params">($name)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Psr-Http-Message-ResponseInterface"><a href="#Psr-Http-Message-ResponseInterface" class="headerlink" title="Psr\Http\Message\ResponseInterface"></a><code>Psr\Http\Message\ResponseInterface</code></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Psr</span>\<span class="title">Http</span>\<span class="title">Message</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Representation of an outgoing, server-side response.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Per the HTTP specification, this interface includes properties for</span></span><br><span class="line"><span class="comment"> * each of the following:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * - Protocol version</span></span><br><span class="line"><span class="comment"> * - Status code and reason phrase</span></span><br><span class="line"><span class="comment"> * - Headers</span></span><br><span class="line"><span class="comment"> * - Message body</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Responses are considered immutable; all methods that might change state MUST</span></span><br><span class="line"><span class="comment"> * be implemented such that they retain the internal state of the current</span></span><br><span class="line"><span class="comment"> * message and return an instance that contains the changed state.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * HTTP 响应是被视为无法修改的，所有能修改状态的方法，都 **必须** 有一套机制，在内部保</span></span><br><span class="line"><span class="comment"> * 持好原有的内容，然后把修改状态后的，新的 HTTP 响应实例返回。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ResponseInterface</span> <span class="keyword">extends</span> <span class="title">MessageInterface</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Gets the response status code.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * The status code is a 3-digit integer result code of the server's attempt</span></span><br><span class="line"><span class="comment">     * to understand and satisfy the request.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> int Status code.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getStatusCode</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return an instance with the specified status code and, optionally, reason phrase.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * If no reason phrase is specified, implementations MAY choose to default</span></span><br><span class="line"><span class="comment">     * to the RFC 7231 or IANA recommended reason phrase for the response's</span></span><br><span class="line"><span class="comment">     * status code.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息实例，然后返回</span></span><br><span class="line"><span class="comment">     * 一个新的修改过的 HTTP 消息实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> http://tools.ietf.org/html/rfc7231#section-6</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> http://www.iana.org/assignments/http-status-codes/http-status-codes.xhtml</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $code The 3-digit integer result code to set.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $reasonPhrase The reason phrase to use with the</span></span><br><span class="line"><span class="comment">     *     provided status code; if none is provided, implementations MAY</span></span><br><span class="line"><span class="comment">     *     use the defaults as suggested in the HTTP specification.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> self</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \InvalidArgumentException For invalid status code arguments.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withStatus</span><span class="params">($code, $reasonPhrase = <span class="string">''</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Gets the response reason phrase associated with the status code.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Because a reason phrase is not a required element in a response</span></span><br><span class="line"><span class="comment">     * status line, the reason phrase value MAY be empty. Implementations MAY</span></span><br><span class="line"><span class="comment">     * choose to return the default RFC 7231 recommended reason phrase (or those</span></span><br><span class="line"><span class="comment">     * listed in the IANA HTTP Status Code Registry) for the response's</span></span><br><span class="line"><span class="comment">     * status code.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> http://tools.ietf.org/html/rfc7231#section-6</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> http://www.iana.org/assignments/http-status-codes/http-status-codes.xhtml</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string Reason phrase; must return an empty string if none present.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getReasonPhrase</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Psr-Http-Message-StreamInterface"><a href="#Psr-Http-Message-StreamInterface" class="headerlink" title="Psr\Http\Message\StreamInterface"></a><code>Psr\Http\Message\StreamInterface</code></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Psr</span>\<span class="title">Http</span>\<span class="title">Message</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Describes a data stream.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Typically, an instance will wrap a PHP stream; this interface provides</span></span><br><span class="line"><span class="comment"> * a wrapper around the most common operations, including serialization of</span></span><br><span class="line"><span class="comment"> * the entire stream to a string.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">StreamInterface</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Reads all data from the stream into a string, from the beginning to end.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This method MUST attempt to seek to the beginning of the stream before</span></span><br><span class="line"><span class="comment">     * reading data and read the stream until the end is reached.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Warning: This could attempt to load a large amount of data into memory.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This method MUST NOT raise an exception in order to conform with PHP's</span></span><br><span class="line"><span class="comment">     * string casting operations.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> http://php.net/manual/en/language.oop5.magic.php#object.tostring</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Closes the stream and any underlying resources.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Separates any underlying resources from the stream.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * After the stream has been detached, the stream is in an unusable state.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> resource|null Underlying PHP stream, if any</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">detach</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get the size of the stream if known.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> int|null Returns the size in bytes if known, or null if unknown.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getSize</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the current position of the file read/write pointer</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> int Position of the file pointer</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \RuntimeException on error.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">tell</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns true if the stream is at the end of the stream.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eof</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns whether or not the stream is seekable.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isSeekable</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Seek to a position in the stream.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> http://www.php.net/manual/en/function.fseek.php</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $offset Stream offset</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $whence Specifies how the cursor position will be calculated</span></span><br><span class="line"><span class="comment">     *     based on the seek offset. Valid values are identical to the built-in</span></span><br><span class="line"><span class="comment">     *     PHP $whence values for `fseek()`.  SEEK_SET: Set position equal to</span></span><br><span class="line"><span class="comment">     *     offset bytes SEEK_CUR: Set position to current location plus offset</span></span><br><span class="line"><span class="comment">     *     SEEK_END: Set position to end-of-stream plus offset.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \RuntimeException on failure.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">seek</span><span class="params">($offset, $whence = SEEK_SET)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Seek to the beginning of the stream.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * If the stream is not seekable, this method will raise an exception;</span></span><br><span class="line"><span class="comment">     * otherwise, it will perform a seek(0).</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> seek()</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> http://www.php.net/manual/en/function.fseek.php</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \RuntimeException on failure.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rewind</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns whether or not the stream is writable.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isWritable</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Write data to the stream.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $string The string that is to be written.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> int Returns the number of bytes written to the stream.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \RuntimeException on failure.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span><span class="params">($string)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns whether or not the stream is readable.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isReadable</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Read data from the stream.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $length Read up to $length bytes from the object and return</span></span><br><span class="line"><span class="comment">     *     them. Fewer than $length bytes may be returned if underlying stream</span></span><br><span class="line"><span class="comment">     *     call returns fewer bytes.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string Returns the data read from the stream, or an empty string</span></span><br><span class="line"><span class="comment">     *     if no bytes are available.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \RuntimeException if an error occurs.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">($length)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the remaining contents in a string</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \RuntimeException if unable to read.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \RuntimeException if error occurs while reading.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getContents</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get stream metadata as an associative array or retrieve a specific key.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * The keys returned are identical to the keys returned from PHP's</span></span><br><span class="line"><span class="comment">     * stream_get_meta_data() function.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> http://php.net/manual/en/function.stream-get-meta-data.php</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $key Specific metadata to retrieve.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array|mixed|null Returns an associative array if no key is</span></span><br><span class="line"><span class="comment">     *     provided. Returns a specific key value if a key is provided and the</span></span><br><span class="line"><span class="comment">     *     value is found, or null if the key is not found.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getMetadata</span><span class="params">($key = null)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Psr-Http-Message-UriInterface"><a href="#Psr-Http-Message-UriInterface" class="headerlink" title="Psr\Http\Message\UriInterface"></a><code>Psr\Http\Message\UriInterface</code></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Psr</span>\<span class="title">Http</span>\<span class="title">Message</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * URI 数据对象。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 此接口按照 RFC 3986 来构建 HTTP URI，提供了一些通用的操作，你可以自由的对此接口</span></span><br><span class="line"><span class="comment"> * 进行扩展。你可以使用此 URI 接口来做 HTTP 相关的操作，也可以使用此接口做任何 URI </span></span><br><span class="line"><span class="comment"> * 相关的操作。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 此接口的实例化对象被视为无法修改的，所有能修改状态的方法，都 **必须** 有一套机制，在内部保</span></span><br><span class="line"><span class="comment"> * 持好原有的内容，然后把修改状态后的，新的实例返回。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> http://tools.ietf.org/html/rfc3986 (URI 通用标准规范)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">UriInterface</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从 URI 中取出 scheme。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 如果不存在 Scheme，此方法 **必须** 返回空字符串。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 返回的数据 **必须** 是小写字母，遵照  RFC 3986 规范 3.1 章节。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 最后部分的 ":" 字串不属于 Scheme，**一定不可** 作为返回数据的一部分。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> https://tools.ietf.org/html/rfc3986#section-3.1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string URI scheme 的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getScheme</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回 URI 授权信息。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 如果没有 URI 信息的话，**必须** 返回一个空数组。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * URI 的授权信息语法是：</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;pre&gt;</span></span><br><span class="line"><span class="comment">     * [user-info@]host[:port]</span></span><br><span class="line"><span class="comment">     * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 如果端口部分没有设置，或者端口不是标准端口，**一定不可** 包含在返回值内。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> https://tools.ietf.org/html/rfc3986#section-3.2</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string URI 授权信息，格式为："[user-info@]host[:port]" </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAuthority</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从 URI 中获取用户信息。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 如果不存在用户信息，此方法 **必须** 返回一个空字符串。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 用户信息后面跟着的 "@" 字符，不是用户信息里面的一部分，**一定不可** 在返回值里</span></span><br><span class="line"><span class="comment">     * 出现。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string URI 的用户信息，格式："username[:password]" </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getUserInfo</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从 URI 信息中获取 HOST 值。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 如果 URI 中没有此值，**必须** 返回空字符串。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 返回的数据 **必须** 是小写字母，遵照  RFC 3986 规范 3.2.2 章节。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> http://tools.ietf.org/html/rfc3986#section-3.2.2</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string URI 信息中的 HOST 值。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getHost</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从 URI 信息中获取端口信息。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 如果端口信息是与当前 Scheme 的标准端口不匹配的话，就使用整数值的格式返回，如果是一</span></span><br><span class="line"><span class="comment">     * 样的话，**必须** 返回 `null` 值。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * 如果存在端口信息，都是不存在 scheme 信息的话，**必须** 返回 `null` 值。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * 如果不存在端口数据，但是 scheme 数据存在的话，**可以** 返回 scheme 对应的</span></span><br><span class="line"><span class="comment">     * 标准端口，但是 **应该** 返回 `null`。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> null|int 从 URI 信息中的端口信息。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPort</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从 URI 信息中获取路径。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  The path can either be empty or absolute (starting with a slash) or</span></span><br><span class="line"><span class="comment">     * rootless (not starting with a slash). Implementations MUST support all</span></span><br><span class="line"><span class="comment">     * three syntaxes.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Normally, the empty path "" and absolute path "/" are considered equal as</span></span><br><span class="line"><span class="comment">     * defined in RFC 7230 Section 2.7.3. But this method MUST NOT automatically</span></span><br><span class="line"><span class="comment">     * do this normalization because in contexts with a trimmed base path, e.g.</span></span><br><span class="line"><span class="comment">     * the front controller, this difference becomes significant. It's the task</span></span><br><span class="line"><span class="comment">     * of the user to handle both "" and "/".</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * The value returned MUST be percent-encoded, but MUST NOT double-encode</span></span><br><span class="line"><span class="comment">     * any characters. To determine what characters to encode, please refer to</span></span><br><span class="line"><span class="comment">     * RFC 3986, Sections 2 and 3.3.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * As an example, if the value should include a slash ("/") not intended as</span></span><br><span class="line"><span class="comment">     * delimiter between path segments, that value MUST be passed in encoded</span></span><br><span class="line"><span class="comment">     * form (e.g., "%2F") to the instance.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> https://tools.ietf.org/html/rfc3986#section-2</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> https://tools.ietf.org/html/rfc3986#section-3.3</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string The URI path.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPath</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Retrieve the query string of the URI.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * If no query string is present, this method MUST return an empty string.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * The leading "?" character is not part of the query and MUST NOT be</span></span><br><span class="line"><span class="comment">     * added.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * The value returned MUST be percent-encoded, but MUST NOT double-encode</span></span><br><span class="line"><span class="comment">     * any characters. To determine what characters to encode, please refer to</span></span><br><span class="line"><span class="comment">     * RFC 3986, Sections 2 and 3.4.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * As an example, if a value in a key/value pair of the query string should</span></span><br><span class="line"><span class="comment">     * include an ampersand ("&amp;") not intended as a delimiter between values,</span></span><br><span class="line"><span class="comment">     * that value MUST be passed in encoded form (e.g., "%26") to the instance.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> https://tools.ietf.org/html/rfc3986#section-2</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> https://tools.ietf.org/html/rfc3986#section-3.4</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string The URI query string.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getQuery</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Retrieve the fragment component of the URI.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * If no fragment is present, this method MUST return an empty string.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * The leading "#" character is not part of the fragment and MUST NOT be</span></span><br><span class="line"><span class="comment">     * added.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * The value returned MUST be percent-encoded, but MUST NOT double-encode</span></span><br><span class="line"><span class="comment">     * any characters. To determine what characters to encode, please refer to</span></span><br><span class="line"><span class="comment">     * RFC 3986, Sections 2 and 3.5.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> https://tools.ietf.org/html/rfc3986#section-2</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> https://tools.ietf.org/html/rfc3986#section-3.5</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string The URI fragment.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFragment</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return an instance with the specified scheme.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This method MUST retain the state of the current instance, and return</span></span><br><span class="line"><span class="comment">     * an instance that contains the specified scheme.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Implementations MUST support the schemes "http" and "https" case</span></span><br><span class="line"><span class="comment">     * insensitively, and MAY accommodate other schemes if required.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * An empty scheme is equivalent to removing the scheme.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $scheme The scheme to use with the new instance.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> self A new instance with the specified scheme.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \InvalidArgumentException for invalid schemes.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \InvalidArgumentException for unsupported schemes.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withScheme</span><span class="params">($scheme)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return an instance with the specified user information.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This method MUST retain the state of the current instance, and return</span></span><br><span class="line"><span class="comment">     * an instance that contains the specified user information.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Password is optional, but the user information MUST include the</span></span><br><span class="line"><span class="comment">     * user; an empty string for the user is equivalent to removing user</span></span><br><span class="line"><span class="comment">     * information.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $user The user name to use for authority.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> null|string $password The password associated with $user.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> self A new instance with the specified user information.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withUserInfo</span><span class="params">($user, $password = null)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return an instance with the specified host.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This method MUST retain the state of the current instance, and return</span></span><br><span class="line"><span class="comment">     * an instance that contains the specified host.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * An empty host value is equivalent to removing the host.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $host The hostname to use with the new instance.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> self A new instance with the specified host.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \InvalidArgumentException for invalid hostnames.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withHost</span><span class="params">($host)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return an instance with the specified port.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This method MUST retain the state of the current instance, and return</span></span><br><span class="line"><span class="comment">     * an instance that contains the specified port.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Implementations MUST raise an exception for ports outside the</span></span><br><span class="line"><span class="comment">     * established TCP and UDP port ranges.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * A null value provided for the port is equivalent to removing the port</span></span><br><span class="line"><span class="comment">     * information.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> null|int $port The port to use with the new instance; a null value</span></span><br><span class="line"><span class="comment">     *     removes the port information.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> self A new instance with the specified port.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \InvalidArgumentException for invalid ports.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withPort</span><span class="params">($port)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return an instance with the specified path.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This method MUST retain the state of the current instance, and return</span></span><br><span class="line"><span class="comment">     * an instance that contains the specified path.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * The path can either be empty or absolute (starting with a slash) or</span></span><br><span class="line"><span class="comment">     * rootless (not starting with a slash). Implementations MUST support all</span></span><br><span class="line"><span class="comment">     * three syntaxes.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * If an HTTP path is intended to be host-relative rather than path-relative</span></span><br><span class="line"><span class="comment">     * then it must begin with a slash ("/"). HTTP paths not starting with a slash</span></span><br><span class="line"><span class="comment">     * are assumed to be relative to some base path known to the application or</span></span><br><span class="line"><span class="comment">     * consumer.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Users can provide both encoded and decoded path characters.</span></span><br><span class="line"><span class="comment">     * Implementations ensure the correct encoding as outlined in getPath().</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $path The path to use with the new instance.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> self A new instance with the specified path.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \InvalidArgumentException for invalid paths.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withPath</span><span class="params">($path)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return an instance with the specified query string.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This method MUST retain the state of the current instance, and return</span></span><br><span class="line"><span class="comment">     * an instance that contains the specified query string.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Users can provide both encoded and decoded query characters.</span></span><br><span class="line"><span class="comment">     * Implementations ensure the correct encoding as outlined in getQuery().</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * An empty query string value is equivalent to removing the query string.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $query The query string to use with the new instance.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> self A new instance with the specified query string.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \InvalidArgumentException for invalid query strings.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withQuery</span><span class="params">($query)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return an instance with the specified URI fragment.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This method MUST retain the state of the current instance, and return</span></span><br><span class="line"><span class="comment">     * an instance that contains the specified URI fragment.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Users can provide both encoded and decoded fragment characters.</span></span><br><span class="line"><span class="comment">     * Implementations ensure the correct encoding as outlined in getFragment().</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * An empty fragment value is equivalent to removing the fragment.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $fragment The fragment to use with the new instance.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> self A new instance with the specified fragment.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withFragment</span><span class="params">($fragment)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return the string representation as a URI reference.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Depending on which components of the URI are present, the resulting</span></span><br><span class="line"><span class="comment">     * string is either a full URI or relative reference according to RFC 3986,</span></span><br><span class="line"><span class="comment">     * Section 4.1. The method concatenates the various components of the URI,</span></span><br><span class="line"><span class="comment">     * using the appropriate delimiters:</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * - If a scheme is present, it MUST be suffixed by ":".</span></span><br><span class="line"><span class="comment">     * - If an authority is present, it MUST be prefixed by "//".</span></span><br><span class="line"><span class="comment">     * - The path can be concatenated without delimiters. But there are two</span></span><br><span class="line"><span class="comment">     *   cases where the path has to be adjusted to make the URI reference</span></span><br><span class="line"><span class="comment">     *   valid as PHP does not allow to throw an exception in __toString():</span></span><br><span class="line"><span class="comment">     *     - If the path is rootless and an authority is present, the path MUST</span></span><br><span class="line"><span class="comment">     *       be prefixed by "/".</span></span><br><span class="line"><span class="comment">     *     - If the path is starting with more than one "/" and no authority is</span></span><br><span class="line"><span class="comment">     *       present, the starting slashes MUST be reduced to one.</span></span><br><span class="line"><span class="comment">     * - If a query is present, it MUST be prefixed by "?".</span></span><br><span class="line"><span class="comment">     * - If a fragment is present, it MUST be prefixed by "#".</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> http://tools.ietf.org/html/rfc3986#section-4.1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Psr-Http-Message-UploadedFileInterface"><a href="#Psr-Http-Message-UploadedFileInterface" class="headerlink" title="Psr\Http\Message\UploadedFileInterface"></a><code>Psr\Http\Message\UploadedFileInterface</code></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Psr</span>\<span class="title">Http</span>\<span class="title">Message</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过 HTTP 请求上传的一个文件内容。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 此接口的实例是被视为无法修改的，所有能修改状态的方法，都 **必须** 有一套机制，在内部保</span></span><br><span class="line"><span class="comment"> * 持好原有的内容，然后把修改状态后的，新的实例返回。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">UploadedFileInterface</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取上传文件的数据流。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 此方法必须返回一个 `StreamInterface` 实例，此方法的目的在于允许 PHP 对获取到的数</span></span><br><span class="line"><span class="comment">     * 据流直接操作，如 stream_copy_to_stream() 。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 如果在调用此方法之前调用了 `moveTo()` 方法，此方法 **必须** 抛出异常。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> StreamInterface 上传文件的数据流</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \RuntimeException 没有数据流的情形下。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \RuntimeException 无法创建数据流。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getStream</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 把上传的文件移动到新目录。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 此方法保证能同时在 `SAPI` 和 `non-SAPI` 环境下使用。实现类库 **必须** 判断</span></span><br><span class="line"><span class="comment">     * 当前处在什么环境下，并且使用合适的方法来处理，如 move_uploaded_file(), rename()</span></span><br><span class="line"><span class="comment">     * 或者数据流操作。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * $targetPath 可以是相对路径，也可以是绝对路径，使用 rename() 解析起来应该是一样的。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 当这一次完成后，原来的文件 **必须** 会被移除。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * 如果此方法被调用多次，一次以后的其他调用，都要抛出异常。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 如果在 SAPI 环境下的话，$_FILES 内有值，当使用  moveTo(), is_uploaded_file()</span></span><br><span class="line"><span class="comment">     * 和 move_uploaded_file() 方法来移动文件时 **应该** 确保权限和上传状态的准确性。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * 如果你希望操作数据流的话，请使用 `getStream()` 方法，因为在 SAPI 场景下，无法</span></span><br><span class="line"><span class="comment">     * 保证书写入数据流目标。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> http://php.net/is_uploaded_file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> http://php.net/move_uploaded_file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $targetPath 目标文件路径。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \InvalidArgumentException 参数有问题时抛出异常。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \RuntimeException 发生任何错误，都抛出此异常。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \RuntimeException 多次运行，也抛出此异常。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">moveTo</span><span class="params">($targetPath)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取文件大小。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 实现类库 **应该** 优先使用 $_FILES 里的 `size` 数值。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> int|null 以 bytes 为单位，或者 null 未知的情况下。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getSize</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取上传文件时出现的错误。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 返回值 **必须** 是 PHP 的 UPLOAD_ERR_XXX 常量。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 如果文件上传成功，此方法 **必须** 返回 UPLOAD_ERR_OK。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 实现类库 **必须** 返回 $_FILES 数组中的 `error` 值。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> http://php.net/manual/en/features.file-upload.errors.php</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> int PHP 的 UPLOAD_ERR_XXX 常量。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getError</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取客户端上传的文件的名称。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * 永远不要信任此方法返回的数据，客户端有可能发送了一个恶意的文件名来攻击你的程序。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * 实现类库 **应该** 返回存储在 $_FILES 数组中 `name` 的值。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string|null 用户上传的名字，或者 null 如果没有此值。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getClientFilename</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 客户端提交的文件类型。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * 永远不要信任此方法返回的数据，客户端有可能发送了一个恶意的文件类型名称来攻击你的程序。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 实现类库 **应该** 返回存储在 $_FILES 数组中 `type` 的值。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string|null 用户上传的类型，或者 null 如果没有此值。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getClientMediaType</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://www.php-fig.org/psr/psr-7/" target="_blank" rel="noopener">PSR-7: HTTP message interfaces</a></li>
<li><a href="https://github.com/summerblue/psr.phphub.org/blob/master/psrs/%E3%80%8CPSR%20%E8%A7%84%E8%8C%83%E3%80%8DPSR-7%20HTTP%20%E6%B6%88%E6%81%AF%E6%8E%A5%E5%8F%A3%E8%A7%84%E8%8C%83.md" target="_blank" rel="noopener">PSR-7 HTTP 消息接口规范</a></li>
</ul>

      
    </div>

    

    
    
    

    

    
      
    
    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div></div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/uploads/wechatpay_cut.jpg" alt="Gavin 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/uploads/alipay_cut.jpg" alt="Gavin 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/php/" rel="tag"># php</a>
          
            <a href="/tags/规范/" rel="tag"># 规范</a>
          
            <a href="/tags/psr/" rel="tag"># psr</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div class="social_share">
            
            
               <div id="needsharebutton-postbottom">
                 <span class="btn">
                    <i class="fa fa-share-alt" aria-hidden="true"></i>
                 </span>
               </div>
            
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/04/10/php-psr6/" rel="next" title="PSR-6 缓存接口规范">
                <i class="fa fa-chevron-left"></i> PSR-6 缓存接口规范
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/05/12/mysql-import-export/" rel="prev" title="MySQL导入与导出">
                MySQL导入与导出 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/uploads/portrait.jpg" alt="Gavin">
            
              <p class="site-author-name" itemprop="name">Gavin</p>
              <p class="site-description motion-element" itemprop="description">宁愿小众,不愿平庸</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives">
                
                    <span class="site-state-item-count">74</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">2</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">114</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                  <a href="https://github.com/gavin66" title="GitHub &rarr; https://github.com/gavin66" rel="noopener" target="_blank">GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                  <a href="https://www.v2ex.com/member/ksaa0096329" title="V2EX &rarr; https://www.v2ex.com/member/ksaa0096329" rel="noopener" target="_blank">V2EX</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                  <a href="https://segmentfault.com/u/gavin66" title="SegmentFault &rarr; https://segmentfault.com/u/gavin66" rel="noopener" target="_blank">SegmentFault</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                  <a href="http://weibo.com/lanbert" title="微博 &rarr; http://weibo.com/lanbert" rel="noopener" target="_blank">微博</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                  <a href="https://www.zhihu.com/people/Gavin23" title="知乎 &rarr; https://www.zhihu.com/people/Gavin23" rel="noopener" target="_blank">知乎</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                  <a href="https://www.douban.com/people/imgavin66" title="豆瓣 &rarr; https://www.douban.com/people/imgavin66" rel="noopener" target="_blank">豆瓣</a>
                </span>
              
            </div>
          

          
             <div class="cc-license motion-element" itemprop="license">
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
             </div>
          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#关于「能愿动词」的使用"><span class="nav-text">关于「能愿动词」的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#规范详情"><span class="nav-text">规范详情</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#消息"><span class="nav-text">消息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP-头信息"><span class="nav-text">HTTP 头信息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#大小写不敏感的字段名字"><span class="nav-text">大小写不敏感的字段名字</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#对应多条数组的头信息"><span class="nav-text">对应多条数组的头信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#主机信息"><span class="nav-text">主机信息</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据流"><span class="nav-text">数据流</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#请求目标和-URI"><span class="nav-text">请求目标和 URI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Server-side-Requests"><span class="nav-text">Server-side Requests</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Uploaded-files"><span class="nav-text">Uploaded files</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Package"><span class="nav-text">Package</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Interfaces"><span class="nav-text">Interfaces</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Psr-Http-Message-MessageInterface"><span class="nav-text">Psr\Http\Message\MessageInterface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Psr-Http-Message-RequestInterface"><span class="nav-text">Psr\Http\Message\RequestInterface</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Psr-Http-Message-ServerRequestInterface"><span class="nav-text">Psr\Http\Message\ServerRequestInterface</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Psr-Http-Message-ResponseInterface"><span class="nav-text">Psr\Http\Message\ResponseInterface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Psr-Http-Message-StreamInterface"><span class="nav-text">Psr\Http\Message\StreamInterface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Psr-Http-Message-UriInterface"><span class="nav-text">Psr\Http\Message\UriInterface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Psr-Http-Message-UploadedFileInterface"><span class="nav-text">Psr\Http\Message\UploadedFileInterface</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-text">参考</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2014 – <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Gavin</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v6.6.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script src="/js/src/utils.js?v=6.6.0"></script>

  <script src="/js/src/motion.js?v=6.6.0"></script>



  
  

  
  <script src="/js/src/scrollspy.js?v=6.6.0"></script>
<script src="/js/src/post-details.js?v=6.6.0"></script>



  


  <script src="/js/src/bootstrap.js?v=6.6.0"></script>



  

  
    <script id="dsq-count-scr" src="https://gavin23.disqus.com/count.js" async></script>
  

  
    <script>
      var disqus_config = function () {
        this.page.url = "http://blog.imgavin.me/2016/04/11/php-psr7/";
        this.page.identifier = "2016/04/11/php-psr7/";
        this.page.title = 'PSR-7 HTTP 消息接口规范';
        };
      function loadComments () {
        var d = document, s = d.createElement('script');
        s.src = 'https://gavin23.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      }
      
        loadComments();
      
    </script>
  













  





  

  
  <script>
    
    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url }) })
        .done(function ({ results }) {
          if (results.length > 0) {
            var counter = results[0];
            
            Counter('put', `/classes/Counter/${counter.objectId}`, JSON.stringify({ time: { "__op":"Increment", "amount":1 } }))
            
            .done(function () {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(counter.time + 1);
            })
            
            .fail(function ({ responseJSON }) {
                console.log('Failed to save Visitor num, with error message: ' + responseJSON.error);
            })
          } else {
            
              var $element = $(document.getElementById(url));
              $element.find('.leancloud-visitors-count').text('Counter not initialized! See more at console err msg.');
              console.error('ATTENTION! LeanCloud counter has security bug, see here how to solve it: https://github.com/theme-next/hexo-leancloud-counter-security. \n But you also can use LeanCloud without security, by set \'security\' option to \'false\'.');
            
          }
        })
      .fail(function ({ responseJSON }) {
        console.log('LeanCloud Counter Error:' + responseJSON.code + " " + responseJSON.error);
      });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + "AhWzg6uJERcSBdfFp24rIGco-gzGzoHsz")
        .done(function ({ api_server }) {
          var Counter = function (method, url, data) {
            return $.ajax({
              method: method,
              url: `https://${api_server}/1.1${url}`,
              headers: {
                'X-LC-Id': "AhWzg6uJERcSBdfFp24rIGco-gzGzoHsz",
                'X-LC-Key': "ygD46J8JRaC0GkifemEHlXCf",
                'Content-Type': 'application/json',
              },
              data: data,
            });
          };
          
          addCount(Counter);
          
        })
    });
  </script>



  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  
  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "default";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "bottomCenter";
      
          pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
  </script>

  

  

  
  <script src="/js/src/js.cookie.js?v=6.6.0"></script>
  <script src="/js/src/scroll-cookie.js?v=6.6.0"></script>


  

  

  

  

</body>
</html>
